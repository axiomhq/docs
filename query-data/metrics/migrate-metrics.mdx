---
title: Migrate to Axiom from PromQL
description: This page explains how to migrate your PromQL queries to Axiom.
---

## Differences between AxQL and PromQL

1) This which implies slightly different data modes - the biggest one here is that we have a much larger set of types where in prometheus everything is a 'string' and people use regexp for every filter. If a user CAN using OTEL so being concious about their types is important when querying
2) Prometheus is icky with too many tags, we are not so PromQL makes liberal use of enrichment queries (joining tags from one series to another) we don't support this yet since it's not a OTEL pattern
3) our histogram opperations allow to generate more then one series while the promql one is limited to one series per query
There might be some other subtle differences I didn't think about or might not know about but that's the main things'\
4) RegEx are a top level type for us, so escaping them is different while in PromQl they are strings and " needs escaping for us, since it's it's own type / needs escaping

## Examples

### Average over time

<CodeGroup>
```kusto Prometheus example
avg_over_time(
   (
      max(
          axiomdb_transport_ingest_pressure\{
             time_window = "1m",
              service =~ "axiomdb-[a-f]"
          \}
       ) <bool 0.4
   )[7d:]
)
````

```kusto AxQL equivalent
test-with-minus.com:axiomdb_transport_ingest_pressure as snot
| where time_window == "1m"
| where service == /axiomdb-[a-f]/
| group using max
| as cookie
| map < 0.4
| align avg(7d)
| as cake
```
</CodeGroup>

### Add label from another metric

Add the label `created_by_kind` from `kube_pod_info`.

<CodeGroup>
```kusto Prometheus example
sum(kube_pod_status_ready) by (pod)
*
on(pod)
group_left(created_by_kind)
kube_pod_info{}
````

```kusto AxQL equivalent
{
    test:kube_pod_status_ready
    | group by pod using sum;
    test:kube_pod_info
    | group by pod, created_by_kind using max;
} join by pod using enrich as ready_status
```
</CodeGroup>

### Multiply each value by 100

<CodeGroup>
```kusto Prometheus example
http_request_duration_seconds_count{} * 100
````

```kusto AxQL equivalent
test:axiom_http_request_duration_seconds_count
| map * 100
```
</CodeGroup>

### Create tag enrichment over two series

Add `internal_ip` from `kube_node_info` to `kube_pod_info` based on the node, then join them to `kube_pod_status_ready` based on the pod.

<CodeGroup>
```kusto Prometheus example
sum(kube_pod_status_ready) by (pod)
*
on(pod)
group_left(node)
kube_pod_info
*
on(node)
group_left(internal_ip)
kube_node_info
````

```kusto AxQL equivalent
{
    test:kube_pod_status_ready
    | group by pod using sum;
    {
        test:kube_pod_info
        | group by pod, internal_ip using max;
        test:kube_node_info
        | group by internal_ip using max;
    } join by internal_ip using enrich as node_info
    | group by pod using max;
} join by pod using enrich as ready_status

```
</CodeGroup>

### Calculate average error rate

Calculate the average error rate per 5-minute windows on a set of HTTP endpoints.

<CodeGroup>
```kusto Prometheus example
sum(rate(http_request_duration_count{           container=~"ingest|api|login", path=~".*(ingest|(?:v1/(traces|logs))).*", code!~"[1234].."}[5m]))
/
sum(rate(http_request_duration_count{container=~"ingest|api|login", path=~".*(ingest|(?:v1/(traces|logs))).*"}[5m]))
````

```kusto AxQL equivalent
{ 
  test:http_request_duration_count
  | filter container =~ /ingest|api|login/
  | filter path =~ /.*(ingest|(?:v1\/(traces|logs))).*/
  | filter code >= 500 
  | map rate
  | align avg(5m)
  | group using sum;
  test:http_request_duration_count
  | filter container =~ /ingest|api|login/
  | filter path =~ /.*(ingest|(?:v1\/(traces|logs))).*/
  | map rate
  | align avg(5m)
  | group using sum
} join using / as error_rate
```
</CodeGroup>

### Calculate CPU saturation

Calculate CPU saturation (actual over requested) of each service.

<CodeGroup>
```kusto Prometheus example
max(
  label_replace(
  (sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~"(axiom|cloud).*",pod=~"ingest-.*"}) by (pod)
    /
    sum(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{namespace=~"(axiom|cloud).*", pod=~"ingest-.*", resource="cpu"}) by (pod)),
  "service", "$1", "pod", "(.+)-.+-.+")
) by (service)
````

```kusto AxQL equivalent
{
    test:container_cpu_usage_seconds_total
    | filter namespace =~ /(axiom|cloud).*/
    | filter pod =~ /ingest-.*/
    | group by pod using sum;
    test:kube_pod_container_resource_requests
    | filter namespace =~ /(axiom|cloud).*/
    | filter pod =~ /ingest-.*/
    | filter resource == "cpu"
    | group by pod using sum;
} join by pod using / as cpu_usage
| replace service = pod ~ s/(.+)-.+-.+/$1/
| group by service using max
```
</CodeGroup>

### Calculate running average

Calculate the running average relation between two metrics.

<CodeGroup>
```kusto Prometheus example
avg_over_time(metric_a[5m]) / avg_over_time(metric_b[1h])
````

```kusto AxQL equivalent
{
    test:metric_a
    | align avg(5m, 1m);
    test:metric_a
    | align avg(1h, 1m)
} join using / as avg_over_time
```
</CodeGroup>

### Calculate rate

Calculate rate of HTTP requests by method, path and http response code.

<CodeGroup>
```kusto Prometheus example
sum by (method, path, code) (
      rate(
          http_requests_total{
              path=~".*(ingest|(?:v1/(traces|logs))).*",
              code=~"[123].."
          }[5m]
      )
  )
````

```kusto AxQL equivalent
test:http_requests_total
| filter path =~ /.*(ingest|(?:v1\/(traces|logs))).*/
| filter code =~ /[123]../
| map rate
| align avg(5m)
| group by method, path, code using sum
```
</CodeGroup>

### Calculate Service Level Objectives (SLO)

Calculate SLO with the goal of max 40% ingest pressure over the running average of 1 hour over the past 7 days.

<CodeGroup>
```kusto Prometheus example
avg_over_time(
  (max(
    transport_ingest_pressure{
      time_window = "1m",
      service =~ "db-[a-f]"
    }
  ) <bool 0.4)[7d:]
)
````

```kusto AxQL equivalent
test:transport_ingest_pressure
| filter time_window == "1m"
| filter service =~ /db-[a-f]/
| group using max
| map < 0.4
| align avg(7d, 1h)
```
</CodeGroup>

### Calculate error rate SLO

Calculate the error rate SLO as a running average over the past seven days, with a goal of 80% success rate.

<CodeGroup>
```kusto Prometheus example
avg_over_time(
    ((
        sum(rate(http_requests_total{container=~"ingest|api|login", path=~".*(ingest|(?:v1/(traces|logs))).*", code!~"[1234].."}[1h]))
        /
        sum(rate(http_requests_total{container=~"ingest|api|login", path=~".*(ingest|(?:v1/(traces|logs))).*"}[1h]))
    ) <bool 0.2)[7d:]
)
````

```kusto AxQL equivalent
{
  test:http_requests_total
  | filter container =~ /ingest|api|login/
  | filter path =~ /.*(ingest|(?:v1\/(traces|logs))).*/ 
  | filter code < 500
  | map rate
  | align avg(1h)
  | group using sum;
  test:http_requests_total
  | filter container =~ /ingest|api|login/
  | filter path =~ /.*(ingest|(?:v1\/(traces|logs))).*/ 
  | map rate
  | align avg(1h)
  | group using sum
} join using / as error_rate
| map < 0.2
| align avg(7d, 1h)
```
</CodeGroup>
