---
title: set_difference
description: 'This page explains how to use the set_difference function in APL.'
---

Use the `set_difference` function in APL to compute the distinct elements in one array that are not present in another. This function helps you filter out shared values between two arrays, producing a new array that includes only the unique values from the first input array.

Use `set_difference` when you need to identify new or missing elements, such as:

- Users who visited today but not yesterday.
- Error codes that occurred in one region but not another.
- Service calls that appear in staging but not production.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

In Splunk SPL, similar logic often uses the `setdiff` function from the `mv` (multivalue) function family. APL’s `set_difference` behaves similarly, returning values that are only in the first multivalue field.

<CodeGroup>
```sql Splunk example
| eval a=mvappend("a", "b", "c"), b=mvappend("b", "c")
| eval diff=mvfilter(NOT match(a, b))
````

```kusto APL equivalent
print a=dynamic(['a', 'b', 'c']), b=dynamic(['b', 'c'])
| extend diff=set_difference(a, b)
```

</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

ANSI SQL doesn’t support array operations directly, but you can emulate set difference with `EXCEPT` when working with rows, not arrays. APL provides native array functions like `set_difference` for this purpose.

<CodeGroup>
```sql SQL example
SELECT value FROM array1
EXCEPT
SELECT value FROM array2;
```

```kusto APL equivalent
print a=dynamic(['a', 'b', 'c']), b=dynamic(['b', 'c'])
| extend diff=set_difference(a, b)
```

</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
set_difference(array1, array2)
```

### Parameters

| Name     | Type  | Description                                          |
| -------- | ----- | ---------------------------------------------------- |
| `array1` | array | The array to subtract from.                          |
| `array2` | array | The array containing values to remove from `array1`. |

### Returns

An array that includes all values from `array1` that are not present in `array2`. The result does not include duplicates.

## Use case examples

<Tabs>
<Tab title="Log analysis">

Use `set_difference` to identify which URLs were accessed in a specific city but not in another. This helps you compare user behavior across regions.

**Query**

```kusto
let ny_uris = 
    ['sample-http-logs']
    | where ['geo.city'] == 'New York'
    | summarize uris = make_set(uri);
let la_uris = 
    ['sample-http-logs']
    | where ['geo.city'] == 'Los Angeles'
    | summarize uris = make_set(uri);
ny_uris
| join kind=inner (la_uris) on $left.uris != $right.uris
| project uri_diff = set_difference(ny_uris, la_uris)
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22let%20ny_uris%20%3D%20%20%20%20%5B'sample-http-logs'%5D%20%20%20%20%7C%20where%20%5B'geo.city'%5D%20%3D%3D%20'New%20York'%20%20%20%20%7C%20summarize%20uris%20%3D%20make_set%28uri%29%3B%0Alet%20la_uris%20%3D%20%20%20%20%5B'sample-http-logs'%5D%20%20%20%20%7C%20where%20%5B'geo.city'%5D%20%3D%3D%20'Los%20Angeles'%20%20%20%20%7C%20summarize%20uris%20%3D%20make_set%28uri%29%3B%0Any_uris%0A%7C%20join%20kind%3Dinner%20%28la_uris%29%20on%20%24left.uris%20!%3D%20%24right.uris%0A%7C%20project%20uri_diff%20%3D%20set_difference%28ny_uris%2C%20la_uris%29%22%7D)

**Output**

| uri_diff           |
| ------------------- |
| [`/shop`, `/cart`] |

This query identifies which endpoints are accessed by users in New York but not in Los Angeles.

</Tab>
<Tab title="OpenTelemetry traces">

Use `set_difference` to detect which service kinds are used by `frontend` but not by `frontendproxy`.

**Query**

```kusto
let frontend_kinds =
    ['otel-demo-traces']
    | where ['service.name'] == 'frontend'
    | summarize kinds = make_set(kind);
let proxy_kinds =
    ['otel-demo-traces']
    | where ['service.name'] == 'frontendproxy'
    | summarize kinds = make_set(kind);
frontend_kinds
| join kind=inner (proxy_kinds) on 1==1
| project kind_diff = set_difference(frontend_kinds, proxy_kinds)
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22let%20frontend_kinds%20%3D%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontend'%20%7C%20summarize%20kinds%20%3D%20make_set%28kind%29%3B%0Alet%20proxy_kinds%20%3D%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontendproxy'%20%7C%20summarize%20kinds%20%3D%20make_set%28kind%29%3B%0Afrontend_kinds%0A%7C%20join%20kind%3Dinner%20%28proxy_kinds%29%20on%201%3D%3D1%0A%7C%20project%20kind_diff%20%3D%20set_difference%28frontend_kinds%2C%20proxy_kinds%29%22%7D)

**Output**

| kind_diff  |
| ----------- |
| [`client`] |

This query shows which service kinds are exclusive to the `frontend` service.

</Tab>
<Tab title="Security logs">

Use `set_difference` to compare status codes seen in two countries, such as the US and Canada, to identify issues unique to one region.

**Query**

```kusto
let us_statuses = 
    ['sample-http-logs']
    | where ['geo.country'] == 'United States'
    | summarize codes = make_set(status);
let ca_statuses = 
    ['sample-http-logs']
    | where ['geo.country'] == 'Canada'
    | summarize codes = make_set(status);
us_statuses
| join kind=inner (ca_statuses) on 1==1
| project status_diff = set_difference(us_statuses, ca_statuses)
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22let%20us_statuses%20%3D%20%5B'sample-http-logs'%5D%20%7C%20where%20%5B'geo.country'%5D%20%3D%3D%20'United%20States'%20%7C%20summarize%20codes%20%3D%20make_set%28status%29%3B%0Alet%20ca_statuses%20%3D%20%5B'sample-http-logs'%5D%20%7C%20where%20%5B'geo.country'%5D%20%3D%3D%20'Canada'%20%7C%20summarize%20codes%20%3D%20make_set%28status%29%3B%0Aus_statuses%0A%7C%20join%20kind%3Dinner%20%28ca_statuses%29%20on%201%3D%3D1%0A%7C%20project%20status_diff%20%3D%20set_difference%28us_statuses%2C%20ca_statuses%29%22%7D)

**Output**

| status_diff    |
| --------------- |
| [`500`, `503`] |

This query identifies HTTP errors that occur only in the United States.

</Tab>
</Tabs>

## List of related functions

- [set_union](apl/scalar-functions/mathematical-functions/set-union): Combines all unique elements from both arrays. Use when you want the full set of distinct values.
