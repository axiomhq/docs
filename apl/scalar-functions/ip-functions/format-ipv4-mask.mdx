---
title: format_ipv4_mask
description: 'This page explains how to use the format_ipv4_mask function in APL.'
---

Use the `format_ipv4_mask` function to format an IPv4 address and a bitmask into Classless Inter-Domain Routing (CIDR) notation. This function is useful when you need to standardize or analyze network addresses, especially in datasets that contain raw IPs or numerical IP representations. It supports both string-based and numeric IPv4 inputs and can apply an optional prefix to generate a subnet mask.

You can use `format_ipv4_mask` to normalize IP addresses, extract network segments, or apply filtering or grouping logic based on subnet granularity.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

SPL doesn’t have a direct built-in equivalent to `format_ipv4_mask`. To format IPv4 addresses with subnet masks, you typically use custom field extractions or external lookup tables. In contrast, APL provides a native function for this task, simplifying analysis at the network or subnet level.

<CodeGroup>
```sql Splunk example
| eval cidr=ip."/24"
````

```kusto APL equivalent
format_ipv4_mask('192.168.1.10', 24)
```

</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

Standard SQL lacks native functions for manipulating IP addresses or CIDR notation. This type of transformation usually requires application-side logic or user-defined functions (UDFs). APL simplifies this by offering a first-class function for formatting IPs directly in queries.

<CodeGroup>
```sql SQL example
-- Requires custom UDF or external processing
SELECT format_ip_with_mask(ip, 24) FROM connections
```

```kusto APL equivalent
format_ipv4_mask(ip, 24)
```

</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
format_ipv4_mask(ip [, prefix])
```

### Parameters

| Name   | Type   | Required | Description                                                                                             |
| ------ | ------ | -------- | ------------------------------------------------------------------------------------------------------- |
| ip     | string | ✔️       | The IPv4 address in CIDR notation. You can use a string (e.g., `'192.168.1.1'`) or a big-endian number. |
| prefix | int    |          | Optional. An integer between 0 and 32. Specifies how many leading bits to include in the mask.          |

### Returns

A string representing the IPv4 address in CIDR notation if the conversion succeeds. If the conversion fails, the function returns an empty string.

## Use case examples

<Tabs>
<Tab title="Log analysis">

Use `format_ipv4_mask` to group requests by subnet and analyze access patterns by network range.

**Query**

```kusto
['sample-http-logs']
| extend subnet = format_ipv4_mask('192.168.1.54', 24)
| summarize count() by subnet
```

\[Run in Playground]\([https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27sample-http-logs%27%5D](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27sample-http-logs%27%5D) %7C extend subnet %3D format\_ipv4\_mask('192.168.1.54'%2C 24) %7C summarize count() by subnet%22%7D)

**Output**

| subnet         | count |
| -------------- | ----- |
| 192.168.1.0/24 | 125   |

This query formats a sample IP into CIDR form and aggregates HTTP request counts by subnet.

</Tab>
<Tab title="OpenTelemetry traces">

Use `format_ipv4_mask` to tag service spans with subnet identifiers, especially for identifying internal versus external traffic ranges.

**Query**

```kusto
['otel-demo-traces']
| extend client_ip = '10.0.14.52'
| extend client_subnet = format_ipv4_mask(client_ip, 16)
| summarize count() by client_subnet, ['service.name']
```

\[Run in Playground]\([https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27otel-demo-traces%27%5D](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27otel-demo-traces%27%5D) %7C extend client\_ip %3D '10.0.14.52' %7C extend client\_subnet %3D format\_ipv4\_mask(client\_ip%2C 16) %7C summarize count() by client\_subnet%2C %5B%27service.name%27%5D%22%7D)

**Output**

| client\_subnet | service.name          | count |
| -------------- | --------------------- | ----- |
| 10.0.0.0/16    | productcatalogservice | 40    |

This query creates a client subnet tag from an IP and summarizes trace spans per subnet and service.

</Tab>
<Tab title="Security logs">

Use `format_ipv4_mask` to detect unusual request volumes from specific subnets, helping identify possible coordinated attacks or misconfigured clients.

**Query**

```kusto
['sample-http-logs']
| extend source_ip = '172.16.5.4'
| extend subnet = format_ipv4_mask(source_ip, 20)
| summarize count() by subnet, status
| where count_ > 100
```

\[Run in Playground]\([https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27sample-http-logs%27%5D](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B%27sample-http-logs%27%5D) %7C extend source\_ip %3D '172.16.5.4' %7C extend subnet %3D format\_ipv4\_mask(source\_ip%2C 20) %7C summarize count() by subnet%2C status %7C where count\_ > 100%22%7D)

**Output**

| subnet        | status | count |
| ------------- | ------ | ----- |
| 172.16.0.0/20 | 403    | 230   |

This query identifies subnets generating large volumes of forbidden requests.

</Tab>
</Tabs>

## List of related functions

* [parse\_ipv4](/apl/network-functions/parse_ipv4): Converts a string representation of an IPv4 address into its numeric form. Use it when you need to perform bitwise operations or comparisons.
* [ipv4\_is\_match](/apl/network-functions/ipv4_is_match): Checks if an IPv4 address matches a specific CIDR subnet. Use it for filtering IPs within subnets.
* [format\_ipv4](/apl/network-functions/format_ipv4): Converts a numeric IPv4 address into its string format. Use it when formatting addresses without applying a mask.
* [extract\_ipv4](/apl/network-functions/extract_ipv4): Extracts IPv4 addresses from a string. Useful when working with unstructured text fields.
* [ipv4\_compare](/apl/network-functions/ipv4_compare): Compares two IPv4 addresses. Use it to determine ordering or equality between IPs.

- [format_ipv4](/apl/scalar-functions/ip-functions/format-ipv4): Converts a 32-bit unsigned integer to an IPv4 address string. Use it when your input is a raw numeric IP instead of a prefix length.
- [parse_ipv4](/apl/scalar-functions/ip-functions/parse-ipv4): Parses an IPv4 string into a numeric representation. Use it when you want to do arithmetic or masking on IP addresses.
- [ipv4_is_in_range](/apl/scalar-functions/ip-functions/ipv4-is-in-range): Checks whether an IPv4 address falls within a given range. Use it when you need to filter or classify IPs against subnets.
