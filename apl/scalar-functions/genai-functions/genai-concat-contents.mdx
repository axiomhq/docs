---
title: 'genai_concat_contents'
description: 'This page explains how to use the genai_concat_contents function in APL.'
---

The `genai_concat_contents` function concatenates all message contents from a GenAI conversation array into a single string. This is useful when you need to combine multiple conversation messages into a single text field for analysis, full-text search, or creating a complete conversation transcript.

You can use this function to create searchable conversation transcripts, prepare data for analysis, or consolidate conversation history for reporting.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

In Splunk SPL, you would typically use multiple `eval` commands with `mvjoin` to concatenate array values, but thereâ€™s no direct equivalent for extracting and joining message contents from nested structures.

<CodeGroup>
```sql Splunk example
| eval all_content=mvjoin(messages, " ")
```

```kusto APL equivalent
['ai-logs']
| extend all_content = genai_concat_contents(messages, ' ')
```
</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

In ANSI SQL, you would need to unnest the array and use `STRING_AGG` or similar functions to concatenate values, which is more verbose.

<CodeGroup>
```sql SQL example
SELECT 
  conversation_id,
  STRING_AGG(content, ' ') as all_content
FROM conversations
CROSS JOIN UNNEST(messages) as msg
GROUP BY conversation_id
```

```kusto APL equivalent
['ai-logs']
| extend all_content = genai_concat_contents(messages, ' ')
```
</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
genai_concat_contents(messages, separator)
```

### Parameters

- **messages** (dynamic, required): An array of message objects from a GenAI conversation. Each message typically contains a `role` and `content` field.
- **separator** (string, optional): The string used to separate message contents. Default is a space character (`' '`).

### Returns

Returns a string containing all message contents concatenated together with the specified separator.

## Use case examples

<Tabs>
<Tab title="Log analysis">

When analyzing GenAI API logs, you can concatenate all conversation messages to create a searchable transcript for debugging or analysis.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/chat'
| extend full_transcript = genai_concat_contents(todynamic(response_body)['messages'], '\n---\n')
| project _time, id, full_transcript
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fchat'%20%7C%20extend%20full_transcript%20%3D%20genai_concat_contents(todynamic(response_body)%5B'messages'%5D%2C%20'%5Cn---%5Cn')%20%7C%20project%20_time%2C%20id%2C%20full_transcript%22%7D)

**Output**

| _time | id | full_transcript |
|-------|----|-----------------| 
| 2024-01-15T10:30:00Z | user_123 | You are a helpful assistant.---How do I reset my password?---To reset your password, click on 'Forgot Password'... |
| 2024-01-15T10:31:00Z | user_456 | You are a helpful assistant.---What are your business hours?---Our business hours are Monday to Friday, 9 AM to 5 PM. |

This query extracts chat API responses and concatenates all messages from each conversation into a single searchable transcript.

</Tab>
<Tab title="OpenTelemetry traces">

When analyzing AI service traces, you can concatenate conversation contents to understand the full context of each request span.

**Query**

```kusto
['otel-demo-traces']
| where ['service.name'] == 'frontend' and kind == 'server'
| extend conversation_text = genai_concat_contents(todynamic(attributes['ai.messages']), ' | ')
| project _time, trace_id, span_id, conversation_text
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontend'%20and%20kind%20%3D%3D%20'server'%20%7C%20extend%20conversation_text%20%3D%20genai_concat_contents(todynamic(attributes%5B'ai.messages'%5D)%2C%20'%20%7C%20')%20%7C%20project%20_time%2C%20trace_id%2C%20span_id%2C%20conversation_text%22%7D)

**Output**

| _time | trace_id | span_id | conversation_text |
|-------|----------|---------|-------------------|
| 2024-01-15T10:30:00Z | abc123 | span_001 | Hello, how can I help? \| I need assistance \| Of course! |
| 2024-01-15T10:31:00Z | def456 | span_002 | What is your question? \| Tell me about your services |

This query extracts AI conversation messages from trace spans and creates a concatenated view for analysis.

</Tab>
<Tab title="Security logs">

In security monitoring, you can concatenate GenAI conversation contents to detect suspicious patterns or policy violations across the entire conversation.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/ai'
| extend full_conversation = genai_concat_contents(todynamic(request_body)['messages'], ' ')
| where full_conversation contains 'admin password' or full_conversation contains 'credentials'
| project _time, id, ['geo.country'], full_conversation
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fai'%20%7C%20extend%20full_conversation%20%3D%20genai_concat_contents(todynamic(request_body)%5B'messages'%5D%2C%20'%20')%20%7C%20where%20full_conversation%20contains%20'admin%20password'%20or%20full_conversation%20contains%20'credentials'%20%7C%20project%20_time%2C%20id%2C%20%5B'geo.country'%5D%2C%20full_conversation%22%7D)

**Output**

| _time | id | geo.country | full_conversation |
|-------|----|--------------|--------------------|
| 2024-01-15T10:30:00Z | user_789 | US | Can you help me retrieve the admin password for this system? |
| 2024-01-15T10:35:00Z | user_234 | UK | I forgot my credentials, can you show them? |

This query detects potentially suspicious requests by searching for sensitive keywords across entire GenAI conversations.

</Tab>
</Tabs>

## List of related functions

- [genai_extract_user_prompt](/apl/scalar-functions/genai-functions/genai-extract-user-prompt): Extracts only the user's prompt instead of all messages. Use this when you need just the user's input.
- [genai_extract_assistant_response](/apl/scalar-functions/genai-functions/genai-extract-assistant-response): Extracts only the assistant's response. Use this when you need just the AI's output.
- [genai_get_content_by_role](/apl/scalar-functions/genai-functions/genai-get-content-by-role): Gets content filtered by a specific role. Use this when you need messages from a particular role like 'system' or 'tool'.
- [genai_message_roles](/apl/scalar-functions/genai-functions/genai-message-roles): Extracts all message roles from a conversation. Use this to understand the conversation structure.
- [strcat_array](/apl/scalar-functions/array-functions/strcat-array): Concatenates a simple string array. Use this for non-GenAI arrays that don't have the message structure.

