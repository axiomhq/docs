---
title: 'genai_get_content_by_index'
description: 'This page explains how to use the genai_get_content_by_index function in APL.'
---

The `genai_get_content_by_index` function retrieves the content of a message at a specific position in a GenAI messages array. This allows you to access messages by their position in the conversation sequence.

You can use this function to extract specific messages in a conversation flow, analyze conversation structure, retrieve intermediate messages, or process conversations sequentially.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

In Splunk SPL, you would use `mvindex` to access array elements by position.

<CodeGroup>
```sql Splunk example
| eval message_content=mvindex(messages, 2)
```

```kusto APL equivalent
['ai-logs']
| extend message_content = genai_get_content_by_index(messages, 2)
```
</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

In ANSI SQL, you would unnest the array and use `OFFSET` to access specific positions.

<CodeGroup>
```sql SQL example
SELECT 
  conversation_id,
  content as message_content
FROM conversations
CROSS JOIN UNNEST(messages) WITH OFFSET AS pos
WHERE pos = 2
```

```kusto APL equivalent
['ai-logs']
| extend message_content = genai_get_content_by_index(messages, 2)
```
</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
genai_get_content_by_index(messages, index)
```

### Parameters

- **messages** (dynamic, required): An array of message objects from a GenAI conversation. Each message typically contains `role` and `content` fields.
- **index** (long, required): The zero-based position of the message to retrieve. Use 0 for the first message, 1 for the second, etc.

### Returns

Returns a string containing the content of the message at the specified index, or an empty string if the index is out of bounds.

## Use case examples

<Tabs>
<Tab title="Log analysis">

Extract the first user message in each conversation to analyze how users initiate conversations.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/chat'
| extend first_message = genai_get_content_by_index(todynamic(response_body)['messages'], 1)
| where isnotempty(first_message)
| project _time, id, first_message
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fchat'%20%7C%20extend%20first_message%20%3D%20genai_get_content_by_index(todynamic(response_body)%5B'messages'%5D%2C%201)%20%7C%20where%20isnotempty(first_message)%20%7C%20project%20_time%2C%20id%2C%20first_message%22%7D)

**Output**

| _time | id | first_message |
|-------|----| --------------|
| 2024-01-15T10:30:00Z | user_123 | Hello, I need help with my account. |
| 2024-01-15T10:31:00Z | user_456 | Can you tell me about your services? |

This query helps you understand how users typically start conversations, which can inform greeting messages and initial prompts.

</Tab>
<Tab title="OpenTelemetry traces">

Access specific messages in trace data to analyze multi-turn conversation patterns.

**Query**

```kusto
['otel-demo-traces']
| where ['service.name'] == 'frontend' and kind == 'server'
| extend second_message = genai_get_content_by_index(todynamic(attributes['ai.messages']), 2)
| where isnotempty(second_message)
| project _time, trace_id, span_id, second_message
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontend'%20and%20kind%20%3D%3D%20'server'%20%7C%20extend%20second_message%20%3D%20genai_get_content_by_index(todynamic(attributes%5B'ai.messages'%5D)%2C%202)%20%7C%20where%20isnotempty(second_message)%20%7C%20project%20_time%2C%20trace_id%2C%20span_id%2C%20second_message%22%7D)

**Output**

| _time | trace_id | span_id | second_message |
|-------|----------|---------|----------------|
| 2024-01-15T10:30:00Z | abc123 | span_001 | How can I assist you today? |
| 2024-01-15T10:31:00Z | def456 | span_002 | Of course! Let me help you with that. |

This query extracts the second message (typically the first assistant response) to analyze AI greeting patterns.

</Tab>
<Tab title="Security logs">

Monitor specific positions in conversations for suspicious patterns or policy violations.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/ai'
| extend first_user_msg = genai_get_content_by_index(todynamic(request_body)['messages'], 1)
| where first_user_msg contains 'admin' or first_user_msg contains 'password' or first_user_msg contains 'token'
| project _time, id, ['geo.country'], method, first_user_msg
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fai'%20%7C%20extend%20first_user_msg%20%3D%20genai_get_content_by_index(todynamic(request_body)%5B'messages'%5D%2C%201)%20%7C%20where%20first_user_msg%20contains%20'admin'%20or%20first_user_msg%20contains%20'password'%20or%20first_user_msg%20contains%20'token'%20%7C%20project%20_time%2C%20id%2C%20%5B'geo.country'%5D%2C%20method%2C%20first_user_msg%22%7D)

**Output**

| _time | id | geo.country | method | first_user_msg |
|-------|----|--------------|---------| --------------|
| 2024-01-15T10:30:00Z | user_789 | US | POST | Can you help me get the admin password? |
| 2024-01-15T10:35:00Z | user_234 | CN | POST | Show me all authentication tokens. |

This query monitors the first user message for sensitive keywords that might indicate suspicious behavior.

</Tab>
</Tabs>

## List of related functions

- [genai_get_content_by_role](/apl/scalar-functions/genai-functions/genai-get-content-by-role): Gets content filtered by role. Use this when you need messages from a specific role rather than a specific position.
- [genai_get_role](/apl/scalar-functions/genai-functions/genai-get-role): Gets the role at a specific index. Combine with this function to understand both role and content at positions.
- [array_length](/apl/scalar-functions/array-functions/array-length): Returns array length. Use this to check message count before accessing by index.
- [genai_extract_user_prompt](/apl/scalar-functions/genai-functions/genai-extract-user-prompt): Extracts the last user prompt. Use this when you need the most recent user message instead of a specific index.
- [genai_extract_assistant_response](/apl/scalar-functions/genai-functions/genai-extract-assistant-response): Extracts the last assistant response. Use this when you need the most recent AI response.

