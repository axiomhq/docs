---
title: 'genai_extract_function_results'
description: 'This page explains how to use the genai_extract_function_results function in APL.'
---

The `genai_extract_function_results` function extracts function call results from GenAI messages. When an AI model uses function calling (also known as tool calling), the results are stored in specific message roles. This function retrieves those results for analysis.

You can use this function to monitor function call outcomes, debug tool integrations, analyze API usage patterns, or track the effectiveness of function calls in AI workflows.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

In Splunk SPL, you would need to use complex filtering and extraction logic to isolate function results from nested message structures.

<CodeGroup>
```sql Splunk example
| eval function_results=mvfilter(match(role, "function") OR match(role, "tool"))
| eval results=mvindex(function_results, 0)
```

```kusto APL equivalent
['ai-logs']
| extend results = genai_extract_function_results(messages)
```
</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

In ANSI SQL, you would need to unnest arrays and filter for function or tool roles, which is more complex.

<CodeGroup>
```sql SQL example
SELECT 
  conversation_id,
  JSON_EXTRACT(content, '$.result') as function_results
FROM conversations
CROSS JOIN UNNEST(messages)
WHERE role IN ('function', 'tool')
```

```kusto APL equivalent
['ai-logs']
| extend function_results = genai_extract_function_results(messages)
```
</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
genai_extract_function_results(messages)
```

### Parameters

| Name | Type | Required | Description |
|------|------|----------|-------------|
| messages | dynamic | Yes | An array of message objects from a GenAI conversation. Each message typically contains `role` and `content` fields. |

### Returns

Returns a dynamic object containing the function call results from the conversation, or null if no function results are found.

## Use case examples

<Tabs>
<Tab title="Log analysis">

Extract function call results to analyze which external tools and APIs are being used by your AI system.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/chat'
| extend function_results = genai_extract_function_results(todynamic(response_body)['messages'])
| where isnotnull(function_results)
| project _time, id, req_duration_ms, function_results
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fchat'%20%7C%20extend%20function_results%20%3D%20genai_extract_function_results(todynamic(response_body)%5B'messages'%5D)%20%7C%20where%20isnotnull(function_results)%20%7C%20project%20_time%2C%20id%2C%20req_duration_ms%2C%20function_results%22%7D)

**Output**

| _time | id | req_duration_ms | function_results |
|-------|----|-----------------| -----------------|
| 2024-01-15T10:30:00Z | user_123 | 2450 | `{"status": "success", "data": {"temperature": 72, "humidity": 45}}` |
| 2024-01-15T10:31:00Z | user_456 | 1980 | `{"status": "success", "data": {"balance": 1250.50}}` |

This query shows function call results and correlates them with request duration, helping you understand tool execution performance.

</Tab>
<Tab title="OpenTelemetry traces">

Monitor function calling patterns across AI services to understand tool usage and performance.

**Query**

```kusto
['otel-demo-traces']
| where ['service.name'] == 'frontend' and kind == 'server'
| extend tool_results = genai_extract_function_results(todynamic(attributes['ai.messages']))
| where isnotnull(tool_results)
| project _time, trace_id, span_id, duration, tool_results
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontend'%20and%20kind%20%3D%3D%20'server'%20%7C%20extend%20tool_results%20%3D%20genai_extract_function_results(todynamic(attributes%5B'ai.messages'%5D))%20%7C%20where%20isnotnull(tool_results)%20%7C%20project%20_time%2C%20trace_id%2C%20span_id%2C%20duration%2C%20tool_results%22%7D)

**Output**

| _time | trace_id | span_id | duration | tool_results |
|-------|----------|---------|----------|--------------|
| 2024-01-15T10:30:00Z | abc123 | span_001 | 2.1s | `{"api_call": "get_weather", "result": "sunny"}` |
| 2024-01-15T10:31:00Z | def456 | span_002 | 1.5s | `{"api_call": "check_stock", "result": 45}` |

This query helps you understand how function calls impact service latency and what tools are being invoked.

</Tab>
<Tab title="Security logs">

Monitor function call results for security anomalies, unauthorized access attempts, or data exfiltration.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/ai'
| extend func_results = genai_extract_function_results(todynamic(response_body)['messages'])
| where isnotnull(func_results)
| extend result_str = tostring(func_results)
| where result_str contains 'error' or result_str contains 'unauthorized' or result_str contains 'denied'
| project _time, id, ['geo.country'], uri, func_results
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fai'%20%7C%20extend%20func_results%20%3D%20genai_extract_function_results(todynamic(response_body)%5B'messages'%5D)%20%7C%20where%20isnotnull(func_results)%20%7C%20extend%20result_str%20%3D%20tostring(func_results)%20%7C%20where%20result_str%20contains%20'error'%20or%20result_str%20contains%20'unauthorized'%20or%20result_str%20contains%20'denied'%20%7C%20project%20_time%2C%20id%2C%20%5B'geo.country'%5D%2C%20uri%2C%20func_results%22%7D)

**Output**

| _time | id | geo.country | uri | func_results |
|-------|----|--------------|----|--------------|
| 2024-01-15T10:30:00Z | user_789 | US | /api/ai/agent | `{"status": "error", "message": "unauthorized access"}` |
| 2024-01-15T10:35:00Z | user_234 | RU | /api/ai/chat | `{"status": "denied", "reason": "insufficient permissions"}` |

This query identifies failed function calls that might indicate security issues or unauthorized access attempts.

</Tab>
</Tabs>

## List of related functions

- [genai_extract_tool_calls](/apl/scalar-functions/genai-functions/genai-extract-tool-calls): Extracts the tool call requests. Use this to see what functions were requested, while genai_extract_function_results shows the results.
- [genai_has_tool_calls](/apl/scalar-functions/genai-functions/genai-has-tool-calls): Checks if messages contain tool calls. Use this to filter conversations that use function calling.
- [genai_get_content_by_role](/apl/scalar-functions/genai-functions/genai-get-content-by-role): Gets content by specific role. Use this for more granular extraction when you need specific role messages.
- [genai_extract_assistant_response](/apl/scalar-functions/genai-functions/genai-extract-assistant-response): Extracts assistant responses. Use this when you need the AI's text response instead of function results.

