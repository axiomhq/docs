---
title: 'genai_cost'
description: 'This page explains how to use the genai_cost function in APL.'
---

The `genai_cost` function calculates the total cost of a GenAI API call based on the model name, input tokens, and output tokens. This function uses current pricing information for various AI models to provide accurate cost estimates.

You can use this function to track AI spending, analyze cost per conversation, identify expensive queries, or create cost reports and budgets for AI services.

## For users of other query languages

If you come from other query languages, this section explains how to adjust your existing queries to achieve the same results in APL.

<AccordionGroup>
<Accordion title="Splunk SPL users">

In Splunk SPL, you would need to manually calculate costs using eval and lookup tables.

<CodeGroup>
```sql Splunk example
| lookup model_pricing model OUTPUT input_price output_price
| eval total_cost=(input_tokens * input_price / 1000000) + (output_tokens * output_price / 1000000)
```

```kusto APL equivalent
['ai-logs']
| extend total_cost = genai_cost(model, input_tokens, output_tokens)
```
</CodeGroup>

</Accordion>
<Accordion title="ANSI SQL users">

In ANSI SQL, you would need to join with a pricing table and calculate costs manually.

<CodeGroup>
```sql SQL example
SELECT 
  l.*,
  (l.input_tokens * p.input_price / 1000000) + 
  (l.output_tokens * p.output_price / 1000000) as total_cost
FROM ai_logs l
JOIN model_pricing p ON l.model = p.model_name
```

```kusto APL equivalent
['ai-logs']
| extend total_cost = genai_cost(model, input_tokens, output_tokens)
```
</CodeGroup>

</Accordion>
</AccordionGroup>

## Usage

### Syntax

```kusto
genai_cost(model, input_tokens, output_tokens)
```

### Parameters

- **model** (string, required): The name of the AI model (for example, 'gpt-4', 'claude-3-opus', 'gpt-3.5-turbo').
- **input_tokens** (long, required): The number of input tokens (prompt tokens) used in the API call.
- **output_tokens** (long, required): The number of output tokens (completion tokens) generated by the API call.

### Returns

Returns a real number representing the total cost in dollars (USD) for the API call based on the model's pricing.

## Use case examples

<Tabs>
<Tab title="Log analysis">

Calculate the total cost of AI API calls over time to understand spending patterns and optimize usage.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/openai'
| extend api_cost = genai_cost(todynamic(response_body)['model'], todynamic(response_body)['usage']['prompt_tokens'], todynamic(response_body)['usage']['completion_tokens'])
| summarize total_cost = sum(api_cost), avg_cost = avg(api_cost) by bin(_time, 1h)
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fopenai'%20%7C%20extend%20api_cost%20%3D%20genai_cost(todynamic(response_body)%5B'model'%5D%2C%20todynamic(response_body)%5B'usage'%5D%5B'prompt_tokens'%5D%2C%20todynamic(response_body)%5B'usage'%5D%5B'completion_tokens'%5D)%20%7C%20summarize%20total_cost%20%3D%20sum(api_cost)%2C%20avg_cost%20%3D%20avg(api_cost)%20by%20bin(_time%2C%201h)%22%7D)

**Output**

| _time | total_cost | avg_cost |
|-------|------------|----------|
| 2024-01-15T10:00:00Z | 12.45 | 0.0125 |
| 2024-01-15T11:00:00Z | 18.67 | 0.0187 |

This query calculates hourly spending on AI API calls, helping you track costs and identify spending trends.

</Tab>
<Tab title="OpenTelemetry traces">

Track AI costs per service and operation to understand which parts of your application are most expensive.

**Query**

```kusto
['otel-demo-traces']
| where ['service.name'] == 'frontend' and kind == 'server'
| extend api_cost = genai_cost(tostring(attributes['ai.model']), tolong(attributes['ai.prompt_tokens']), tolong(attributes['ai.completion_tokens']))
| summarize total_cost = sum(api_cost) by ['service.name'], operation = name
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'otel-demo-traces'%5D%20%7C%20where%20%5B'service.name'%5D%20%3D%3D%20'frontend'%20and%20kind%20%3D%3D%20'server'%20%7C%20extend%20api_cost%20%3D%20genai_cost(tostring(attributes%5B'ai.model'%5D)%2C%20tolong(attributes%5B'ai.prompt_tokens'%5D)%2C%20tolong(attributes%5B'ai.completion_tokens'%5D))%20%7C%20summarize%20total_cost%20%3D%20sum(api_cost)%20by%20%5B'service.name'%5D%2C%20operation%20%3D%20name%22%7D)

**Output**

| service.name | operation | total_cost |
|--------------|-----------|------------|
| frontend | chat_completion | 45.67 |
| frontend | embeddings_create | 12.34 |

This query breaks down AI costs by service and operation, helping you identify which features are driving costs.

</Tab>
<Tab title="Security logs">

Monitor for unusually high-cost API calls that might indicate abuse, misconfiguration, or malicious activity.

**Query**

```kusto
['sample-http-logs']
| where uri contains '/api/ai'
| extend api_cost = genai_cost(todynamic(request_body)['model'], todynamic(request_body)['max_tokens'], todynamic(response_body)['usage']['completion_tokens'])
| where api_cost > 1.0
| project _time, id, ['geo.country'], method, api_cost
```

[Run in Playground](https://play.axiom.co/axiom-play-qf1k/query?initForm=%7B%22apl%22%3A%22%5B'sample-http-logs'%5D%20%7C%20where%20uri%20contains%20'%2Fapi%2Fai'%20%7C%20extend%20api_cost%20%3D%20genai_cost(todynamic(request_body)%5B'model'%5D%2C%20todynamic(request_body)%5B'max_tokens'%5D%2C%20todynamic(response_body)%5B'usage'%5D%5B'completion_tokens'%5D)%20%7C%20where%20api_cost%20%3E%201.0%20%7C%20project%20_time%2C%20id%2C%20%5B'geo.country'%5D%2C%20method%2C%20api_cost%22%7D)

**Output**

| _time | id | geo.country | method | api_cost |
|-------|----|--------------|---------|---------| 
| 2024-01-15T10:30:00Z | user_789 | US | POST | 1.25 |
| 2024-01-15T10:35:00Z | user_234 | RU | POST | 2.45 |

This query detects API calls with unusually high costs, which could indicate abuse or misconfiguration.

</Tab>
</Tabs>

## List of related functions

- [genai_input_cost](/apl/scalar-functions/genai-functions/genai-input-cost): Calculates only the input token cost. Use this when you need to separate input and output costs.
- [genai_output_cost](/apl/scalar-functions/genai-functions/genai-output-cost): Calculates only the output token cost. Use this when analyzing generation costs separately.
- [genai_get_pricing](/apl/scalar-functions/genai-functions/genai-get-pricing): Gets the pricing structure for a model. Use this to understand or display pricing information.
- [genai_estimate_tokens](/apl/scalar-functions/genai-functions/genai-estimate-tokens): Estimates tokens from text. Use this with genai_cost to predict costs before making API calls.

